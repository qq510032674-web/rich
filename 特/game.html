<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoMo Finance Journey | æ¯›æ¯›ç†è²¡ä¹‹æ—…</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #2d3748;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .page {
        display: none;
      }

      .page.active {
        display: block;
      }

      /* ç™»éŒ„é é¢æ¨£å¼ */
      .login-container {
        max-width: 480px;
        margin: 40px auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 50px 40px;
        border-radius: 24px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .logo-section {
        margin-bottom: 40px;
      }

      .momo-character {
        font-size: 4em;
        margin-bottom: 15px;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .logo-section h1 {
        color: #2d3748;
        margin-bottom: 8px;
        font-size: 2.2em;
        font-weight: 700;
      }

      .tagline {
        color: #718096;
        font-size: 1.1em;
        font-weight: 500;
      }

      .login-form {
        margin-bottom: 30px;
      }

      .input-group {
        margin-bottom: 25px;
        text-align: left;
      }

      .input-group label {
        display: block;
        margin-bottom: 8px;
        color: #2d3748;
        font-weight: 600;
        font-size: 0.95em;
      }

      .input-group input {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
      }

      .input-group input:focus {
        border-color: #667eea;
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        transform: translateY(-2px);
      }

      .primary-btn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
      }

      .primary-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
      }

      .btn-icon {
        font-size: 1.2em;
      }

      /* éŠæˆ²é é¢æ¨£å¼ */
      .game-header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 20px 30px;
        border-radius: 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .player-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .player-avatar {
        font-size: 2.5em;
      }

      .player-details {
        flex: 1;
      }

      .player-details h2 {
        color: #2d3748;
        margin-bottom: 4px;
        font-size: 1.4em;
      }

      .player-details p {
        color: #718096;
        font-size: 0.9em;
      }

      .game-controls {
        text-align: center;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .progress-info {
        background: rgba(255, 255, 255, 0.9);
        padding: 12px 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .location {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 5px;
        font-size: 1em;
      }

      .total-assets {
        font-weight: 700;
        color: #d63031;
        font-size: 1.3em;
      }

      .savings-info {
        font-weight: 600;
        color: #2d3748;
        font-size: 1em;
      }

      .day-info {
        font-weight: 600;
        color: #2d3748;
        font-size: 1em;
      }

      /* éŠæˆ²åœ°åœ–æ¨£å¼ */
      .game-board {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 20px;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        min-height: 600px;
        position: relative;
      }

      .map-container {
        position: relative;
        width: 100%;
        height: 550px;
        background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        border-radius: 16px;
        overflow: hidden;
        border: 3px solid #90caf9;
      }

      .railway-map {
        position: relative;
        width: 100%;
        height: 100%;
      }

      /* éµè·¯ç·šè·¯æ¨£å¼ */
      .rail-lines {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .rail-line {
        position: absolute;
        height: 8px;
        transform-origin: 0 0;
        z-index: 1;
      }

      /* è»Šç«™æ¨™è¨˜æ¨£å¼ */
      .stations {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      .station-marker {
        position: absolute;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 10;
        transition: all 0.3s ease;
      }

      .station-dot {
        width: 24px;
        height: 24px;
        background: #333;
        border-radius: 50%;
        margin: 0 auto 3px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        border: 3px solid white;
        transition: all 0.3s ease;
      }

      .station-name {
        font-size: 8px;
        font-weight: 600;
        color: #333;
        background: rgba(255, 255, 255, 0.9);
        padding: 2px 4px;
        border-radius: 6px;
        white-space: nowrap;
      }

      /* ===== ç©å®¶è³‡è¨Šé¢æ¿æ¨£å¼ ===== */
      .player-info-section {
        padding: 15px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 12px;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: rgba(247, 250, 252, 0.8);
        border-radius: 8px;
        font-size: 0.95em;
        transition: all 0.3s ease;
      }

      .info-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .info-label {
        color: #4a5568;
        font-weight: 600;
      }

      .info-value {
        color: #2d3748;
        font-weight: 700;
      }

      /* ç•¶å‰è»Šç«™æ¨£å¼ */
      .station-marker.current .station-dot {
        background: #ff6b6b;
        border-color: #fff;
        box-shadow: 0 0 15px rgba(255, 107, 107, 0.8);
        animation: pulse 2s infinite;
        transform: scale(1.2);
      }

      @keyframes pulse {
        0% {
          transform: scale(1.2);
        }
        50% {
          transform: scale(1.5);
        }
        100% {
          transform: scale(1.2);
        }
      }

      /* ç©å®¶åœ–æ¨™æ¨£å¼ */
      .player-icon {
        position: absolute;
        font-size: 24px;
        transform: translate(-50%, -50%);
        z-index: 1000;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        transition: all 1s ease-in-out;
        display: none;
      }

      /* æ“ä½œæŒ‰éˆ•çµ„æ¨£å¼ */
      .simple-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 20px;
      }

      .action-btn {
        padding: 15px;
        background: linear-gradient(135deg, #a8e6cf, #88d4ab);
        color: #2d3748;
        border: none;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(168, 230, 207, 0.3);
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(168, 230, 207, 0.4);
      }

      .action-btn.secondary {
        background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
      }

      /* äº‹ä»¶å½ˆçª—æ¨£å¼ */
      .event-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
      }

      .event-modal.active {
        display: flex;
      }

      .event-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .event-emoji {
        font-size: 4em;
        margin-bottom: 20px;
      }

      .event-title {
        font-size: 1.5em;
        font-weight: 700;
        margin-bottom: 15px;
        color: #2d3748;
      }

      .event-message {
        margin-bottom: 25px;
        line-height: 1.6;
        color: #4a5568;
      }

      .event-choices {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-direction: column;
      }

      .choice-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .choice-btn.primary {
        background: #48bb78;
        color: white;
      }

      .choice-btn.secondary {
        background: #e53e3e;
        color: white;
      }

      .choice-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .login-container {
          margin: 20px auto;
          padding: 30px 25px;
        }

        .game-header {
          flex-direction: column;
          gap: 20px;
          text-align: center;
        }

        .player-info {
          justify-content: center;
        }

        .game-board {
          min-height: 500px;
          padding: 20px;
        }

        .map-container {
          height: 450px;
        }

        .station-dot {
          width: 20px;
          height: 20px;
        }

        .station-name {
          font-size: 7px;
        }
      }

      @media (max-width: 480px) {
        .login-container {
          margin: 10px auto;
          padding: 25px 20px;
        }

        .momo-character {
          font-size: 3em;
        }

        .logo-section h1 {
          font-size: 1.8em;
        }

        .game-board {
          min-height: 400px;
          padding: 15px;
        }

        .map-container {
          height: 350px;
        }

        .station-dot {
          width: 16px;
          height: 16px;
        }

        .station-name {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ç™»éŒ„ç•Œé¢ -->
      <div id="login-page" class="page active">
        <div class="login-container">
          <div class="logo-section">
            <div class="momo-character">ğŸ±</div>
            <h1>MoMo Finance Journey<br />æ¯›æ¯›ç†è²¡ä¹‹æ—…</h1>
            <p class="tagline">Learn Financial Skills â€¢ å­¸ç¿’ç†è²¡æŠ€èƒ½</p>
          </div>
          <div class="login-form">
            <div class="input-group">
              <label for="studentId">Student ID å­¸ç”ŸID</label>
              <input
                type="text"
                id="studentId"
                placeholder="Enter your student ID è¼¸å…¥å­¸ç”ŸID"
                required
              />
            </div>
            <div class="input-group">
              <label for="playerNickname">Nickname æš±ç¨±</label>
              <input
                type="text"
                id="playerNickname"
                placeholder="Choose a nickname é¸æ“‡æš±ç¨±"
                required
              />
            </div>
            <button id="startGameBtn" class="primary-btn">
              <span class="btn-icon">ğŸš€</span>
              é–‹å§‹éŠæˆ² Start Game
            </button>
          </div>
        </div>
      </div>

      <!-- éŠæˆ²ä¸»ç•Œé¢ -->
      <div id="game-page" class="page">
        <div class="game-header">
          <div class="player-info">
            <div class="player-avatar">ğŸ±</div>
            <div class="player-details">
              <h2 id="displayNickname">Player</h2>
              <p>ID: <span id="displayStudentId">-</span></p>
              <!-- ç©å®¶è³‡è¨Šé¢æ¿ -->
              <div class="player-info-section">
                <div class="info-grid">
                  <div class="info-item">
                    <span class="info-label">ğŸ“Š ç•¶å‰è³‡ç”¢ï¼š</span>
                    <span class="info-value" id="infoTotalAssets">$1,000</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">ğŸ“… éŠæˆ²å¤©æ•¸ï¼š</span>
                    <span class="info-value" id="infoCurrentDay">ç¬¬ 1 å¤©</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">ğŸš‰ ç•¶å‰è»Šç«™ï¼š</span>
                    <span class="info-value" id="infoCurrentStation">-</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">ğŸ’¹ ç‰©åƒ¹æŒ‡æ•¸ï¼š</span>
                    <span class="info-value" id="infoPriceIndex">1.000</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">ğŸ’° ä»Šæ—¥å„²è“„ï¼š</span>
                    <span class="info-value" id="infoDailySavings">$1</span>
                  </div>
                  <div class="info-item">
                    <span class="info-label">ğŸ¦ ç´¯ç©å„²è“„ï¼š</span>
                    <span class="info-value" id="infoTotalSavings">$0</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="game-controls">
            <div class="control-group">
              <button id="nextDayBtn" class="primary-btn">
                <span class="btn-icon">â­ï¸</span>
                <span class="btn-text">ä¸‹ä¸€å¤© Next Day</span>
              </button>
              <div class="progress-info">
                <div class="day-info">
                  ğŸ“… ç¬¬ <span id="currentDay">1</span> å¤© |
                  <span id="currentDate">2025-10-12 æ˜ŸæœŸæ—¥</span>
                </div>
                <div class="location">
                  ğŸ“ <span id="currentStation">-</span>
                </div>
                <div class="total-assets">
                  ğŸ’° ç¸½è³‡ç”¢ï¼š$<span id="totalAssets">1,000</span>
                </div>
                <div class="savings-info">
                  ğŸ’¾ ä»Šæ—¥å„²è“„ï¼š$<span id="dailySavings">1</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="game-board">
          <div class="map-container">
            <div class="railway-map" id="railway-map">
              <!-- éµè·¯ç·šè·¯å’Œè»Šç«™å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="player-icon" id="player-icon">ğŸ±</div>
          </div>
        </div>

        <div class="simple-actions">
          <button id="newGameBtn" class="action-btn secondary">
            <span class="btn-icon">ğŸ”„</span>
            é‡æ–°éŠæˆ² Restart
          </button>
        </div>
      </div>
    </div>

    <!-- äº‹ä»¶å½ˆçª— -->
    <div id="eventModal" class="event-modal">
      <div class="event-content">
        <div class="event-emoji" id="eventEmoji">ğŸ¯</div>
        <h3 class="event-title" id="eventTitle">äº‹ä»¶æ¨™é¡Œ</h3>
        <p class="event-message" id="eventMessage">äº‹ä»¶æè¿°å…§å®¹...</p>
        <div class="event-choices" id="eventChoices">
          <!-- é¸æ“‡æŒ‰éˆ•å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <script>
      // éŠæˆ²æ•¸æ“š
      const gameBoard = {
        // æ›ä¹˜ç«™åæ¸…å–®
        interchangeStations: [
          "Nam Cheong å—æ˜Œ",
          "Mong Kok æ—ºè§’",
          "Diamond Hill é‘½çŸ³å±±",
          "North Point åŒ—è§’",
          "Admiralty é‡‘é˜",
          "Tiu Keng Leng èª¿æ™¯å¶º",
          "Kowloon Tong ä¹é¾å¡˜",
          "Lai King è”æ™¯",
        ],

        // åœ°éµç·šè·¯é¡è‰²å°ç…§è¡¨
        lineColors: {
          twl: "#e60012", // èƒç£ç·š ç´…è‰²
          tw: "#880022", // å±¯é¦¬ç·š é…’ç´…è‰²
          ktl: "#009944", // è§€å¡˜ç·š ç¶ è‰²
          erl: "#0072bc", // æ±éµç·š è—è‰²
          il: "#003d79", // æ¸¯å³¶ç·š è—é’è‰²
          tkl: "#a864a8", // å°‡è»æ¾³ç·š ç´«è‰²
          tcl: "#f8a800", // æ±æ¶Œç·š æ©™è‰²
        },

        // è»Šç«™æ•¸æ“š
        stations: {
          // === å±¯é¦¬ç·š ===
          "Tuen Mun å±¯é–€": { x: 2, y: 30, line: "tw" },
          "Siu Hong å…†åº·": { x: 2, y: 20, line: "tw" },
          "Tin Shui Wai å¤©æ°´åœ": { x: 2, y: 10, line: "tw" },
          "Long Ping æœ—å±": { x: 7, y: 10, line: "tw" },
          "Yuen Long å…ƒæœ—": { x: 15, y: 10, line: "tw" },
          "Kam Sheung Road éŒ¦ä¸Šè·¯": { x: 20, y: 15, line: "tw" },
          "Tsuen Wan West èƒç£è¥¿": { x: 23, y: 30, line: "tw" },
          "Mei Foo ç¾å­š": { x: 30, y: 30, line: "twl,tw" },
          "Nam Cheong å—æ˜Œ": { x: 30, y: 40, line: "tw,tcl" },
          "Austin æŸ¯å£«ç”¸": { x: 35, y: 60, line: "tw" },
          "East Tsim Sha Tsui å°–æ±": { x: 50, y: 70, line: "tw" },
          "Hung Hom ç´…ç£¡": { x: 65, y: 70, line: "tw,erl" },
          "Ho Man Tin ä½•æ–‡ç”°": { x: 68, y: 60, line: "ktl,tw" },
          "Sung Wong Toi å®‹çš‡è‡º": { x: 75, y: 55, line: "tw" },
          "To Kwa Wan åœŸç“œç£": { x: 80, y: 50, line: "tw" },
          "Kai Tak å•Ÿå¾·": { x: 85, y: 45, line: "tw" },
          "Diamond Hill é‘½çŸ³å±±": { x: 78, y: 40, line: "tkl,tw" },
          "Hin Keng é¡¯å¾‘": { x: 70, y: 40, line: "tw" },
          "Tai Wai å¤§åœ": { x: 65, y: 40, line: "erl,tw" },
          "Che Kung Temple è»Šå…¬å»Ÿ": { x: 70, y: 30, line: "tw" },
          "Sha Tin Wai æ²™ç”°åœ": { x: 75, y: 25, line: "tw" },
          "City One ç¬¬ä¸€åŸ": { x: 80, y: 20, line: "tw" },
          "Shek Mun çŸ³é–€": { x: 85, y: 15, line: "tw" },
          "Tai Shui Hang å¤§æ°´å‘": { x: 85, y: 10, line: "tw" },
          "Heng On æ’å®‰": { x: 85, y: 5, line: "tw" },
          "Ma On Shan é¦¬éå±±": { x: 90, y: 5, line: "tw" },
          "Wu Kai Sha çƒæºªæ²™": { x: 95, y: 5, line: "tw" },

          // === æ±æ¶Œç·š ===
          "Tung Chung æ±æ¶Œ": { x: 10, y: 60, line: "tcl" },
          "Sunny Bay æ¬£æ¾³": { x: 15, y: 55, line: "tcl" },
          "Tsing Yi é’è¡£": { x: 20, y: 50, line: "tcl" },
          "Lai King è”æ™¯": { x: 25, y: 30, line: "twl,tcl" },
          "Nam Cheong å—æ˜Œ": { x: 30, y: 40, line: "tw,tcl" },
          "Olympic å¥§é‹": { x: 35, y: 45, line: "tcl" },
          "Kowloon ä¹é¾": { x: 35, y: 50, line: "tcl" },
          "Hong Kong é¦™æ¸¯": { x: 35, y: 55, line: "tcl" },

          // === èƒç£ç·š ===
          "Tsuen Wan èƒç£": { x: 10, y: 15, line: "twl" },
          "Tai Wo Hau å¤§çª©å£": { x: 15, y: 15, line: "twl" },
          "Kwai Hing è‘µèˆˆ": { x: 20, y: 20, line: "twl" },
          "Kwai Fong è‘µèŠ³": { x: 20, y: 25, line: "twl" },
          "Lai King è”æ™¯": { x: 25, y: 30, line: "twl,tcl" },
          "Mei Foo ç¾å­š": { x: 30, y: 30, line: "twl,tw" },
          "Lai Chi Kok è”æè§’": { x: 35, y: 30, line: "twl" },
          "Cheung Sha Wan é•·æ²™ç£": { x: 40, y: 30, line: "twl" },
          "Sham Shui Po æ·±æ°´åŸ—": { x: 45, y: 30, line: "twl" },
          "Prince Edward å¤ªå­": { x: 50, y: 35, line: "twl,ktl" },
          "Mong Kok æ—ºè§’": { x: 50, y: 40, line: "twl,ktl" },
          "Yau Ma Tei æ²¹éº»åœ°": { x: 50, y: 45, line: "twl,ktl" },
          "Jordan ä½æ•¦": { x: 50, y: 55, line: "twl" },
          "Tsim Sha Tsui å°–æ²™å’€": { x: 50, y: 60, line: "twl" },
          "Admiralty é‡‘é˜": { x: 35, y: 85, line: "twl,il,erl" },
          "Central ä¸­ç’°": { x: 30, y: 85, line: "twl,il" },

          // === æ¸¯å³¶ç·š ===
          "Kennedy Town å …å°¼åœ°åŸ": { x: 5, y: 93, line: "il" },
          "HKU é¦™æ¸¯å¤§å­¸": { x: 10, y: 90, line: "il" },
          "Sai Ying Pun è¥¿ç‡Ÿç›¤": { x: 15, y: 85, line: "il" },
          "Sheung Wan ä¸Šç’°": { x: 20, y: 85, line: "il" },
          "Central ä¸­ç’°": { x: 30, y: 85, line: "twl,il" },
          "Admiralty é‡‘é˜": { x: 35, y: 85, line: "twl,il,erl" },
          "Wan Chai ç£ä»”": { x: 40, y: 85, line: "il" },
          "Causeway Bay éŠ…é‘¼ç£": { x: 45, y: 85, line: "il" },
          "Tin Hau å¤©å": { x: 50, y: 85, line: "il" },
          "Fortress Hill ç‚®å°å±±": { x: 55, y: 85, line: "il" },
          "North Point åŒ—è§’": { x: 60, y: 85, line: "il,tkl" },
          "Quarry Bay é°‚é­šæ¶Œ": { x: 65, y: 85, line: "il,tkl" },
          "Tai Koo å¤ªå¤": { x: 70, y: 85, line: "il" },
          "Sai Wan Ho è¥¿ç£æ²³": { x: 75, y: 85, line: "il" },
          "Shau Kei Wan ç­²ç®•ç£": { x: 80, y: 85, line: "il" },
          "Heng Fa Chuen æèŠ±é‚¨": { x: 85, y: 90, line: "il" },
          "Chai Wan æŸ´ç£": { x: 90, y: 95, line: "il" },

          // === æ±éµç·š ===
          "Lok Ma Chau è½é¦¬æ´²": { x: 25, y: 8, line: "erl" },
          "Sheung Shui ä¸Šæ°´": { x: 35, y: 8, line: "erl" },
          "Fanling ç²‰å¶º": { x: 45, y: 8, line: "erl" },
          "Tai Wo å¤ªå’Œ": { x: 50, y: 8, line: "erl" },
          "Tai Po Market å¤§åŸ”å¢Ÿ": { x: 55, y: 8, line: "erl" },
          "University å¤§å­¸": { x: 65, y: 10, line: "erl" },
          "Fo Tan ç«ç‚­": { x: 65, y: 20, line: "erl" },
          "Sha Tin æ²™ç”°": { x: 65, y: 30, line: "erl" },
          "Tai Wai å¤§åœ": { x: 65, y: 40, line: "erl,tw" },
          "Kowloon Tong ä¹é¾å¡˜": { x: 65, y: 50, line: "erl,tkl" },
          "Mong Kok East æ—ºè§’æ±": { x: 65, y: 60, line: "erl" },
          "Hung Hom ç´…ç£¡": { x: 65, y: 70, line: "tw,erl" },
          "Exhibition Centre æœƒå±•": { x: 50, y: 75, line: "erl" },
          "Admiralty é‡‘é˜": { x: 35, y: 85, line: "twl,il,erl" },

          // === è§€å¡˜ç·š ===
          "Whampoa é»ƒåŸ”": { x: 78, y: 70, line: "ktl" },
          "Ho Man Tin ä½•æ–‡ç”°": { x: 68, y: 60, line: "ktl,tw" },
          "Yau Ma Tei æ²¹éº»åœ°": { x: 50, y: 45, line: "twl,ktl" },
          "Mong Kok æ—ºè§’": { x: 50, y: 40, line: "twl,ktl" },
          "Prince Edward å¤ªå­": { x: 50, y: 35, line: "twl,ktl" },
          "Shek Kip Mei çŸ³ç¡¤å°¾": { x: 55, y: 40, line: "ktl" },
          "Kowloon Tong ä¹é¾å¡˜": { x: 65, y: 50, line: "erl,tkl" },
          "Lok Fu æ¨‚å¯Œ": { x: 70, y: 50, line: "ktl" },
          "Wong Tai Sin é»ƒå¤§ä»™": { x: 75, y: 50, line: "ktl" },
          "Diamond Hill é‘½çŸ³å±±": { x: 78, y: 40, line: "tkl,tw" },
          "Choi Hung å½©è™¹": { x: 85, y: 50, line: "ktl" },
          "Kowloon Bay ä¹é¾ç£": { x: 86, y: 60, line: "ktl" },
          "Ngau Tau Kok ç‰›é ­è§’": { x: 86, y: 70, line: "ktl" },
          "Kwun Tong è§€å¡˜": { x: 86, y: 80, line: "ktl" },
          "Lam Tin è—ç”°": { x: 86, y: 90, line: "ktl" },
          "Yau Tong æ²¹å¡˜": { x: 90, y: 95, line: "tkl,il" },
          "Tiu Keng Leng èª¿æ™¯å¶º": { x: 95, y: 95, line: "tkl" },

          // === å°‡è»æ¾³ç·š ===
          "North Point åŒ—è§’": { x: 60, y: 85, line: "il,tkl" },
          "Quarry Bay é°‚é­šæ¶Œ": { x: 65, y: 85, line: "il,tkl" },
          "Yau Tong æ²¹å¡˜": { x: 90, y: 95, line: "tkl,il" },
          "Tiu Keng Leng èª¿æ™¯å¶º": { x: 95, y: 85, line: "tkl" },
          "Tseung Kwan O å°‡è»æ¾³": { x: 95, y: 75, line: "tkl" },
          "Hang Hau å‘å£": { x: 95, y: 65, line: "tkl" },
          "Po Lam å¯¶ç³": { x: 95, y: 55, line: "tkl" },
          "LOHAS Park åº·åŸ": { x: 95, y: 50, line: "tkl" },
        },

        // ç·šè·¯é€£æ¥é—œä¿‚
        connections: [
          // å±¯é¦¬ç·š
          { from: "Tuen Mun å±¯é–€", to: "Siu Hong å…†åº·", line: "tw" },
          { from: "Siu Hong å…†åº·", to: "Tin Shui Wai å¤©æ°´åœ", line: "tw" },
          { from: "Tin Shui Wai å¤©æ°´åœ", to: "Long Ping æœ—å±", line: "tw" },
          { from: "Long Ping æœ—å±", to: "Yuen Long å…ƒæœ—", line: "tw" },
          { from: "Yuen Long å…ƒæœ—", to: "Kam Sheung Road éŒ¦ä¸Šè·¯", line: "tw" },
          {
            from: "Kam Sheung Road éŒ¦ä¸Šè·¯",
            to: "Tsuen Wan West èƒç£è¥¿",
            line: "tw",
          },
          { from: "Tsuen Wan West èƒç£è¥¿", to: "Mei Foo ç¾å­š", line: "tw" },
          { from: "Mei Foo ç¾å­š", to: "Nam Cheong å—æ˜Œ", line: "tw" },
          { from: "Nam Cheong å—æ˜Œ", to: "Austin æŸ¯å£«ç”¸", line: "tw" },
          { from: "Austin æŸ¯å£«ç”¸", to: "East Tsim Sha Tsui å°–æ±", line: "tw" },
          { from: "East Tsim Sha Tsui å°–æ±", to: "Hung Hom ç´…ç£¡", line: "tw" },
          { from: "Hung Hom ç´…ç£¡", to: "Ho Man Tin ä½•æ–‡ç”°", line: "tw" },
          { from: "Ho Man Tin ä½•æ–‡ç”°", to: "To Kwa Wan åœŸç“œç£", line: "tw" },
          { from: "To Kwa Wan åœŸç“œç£", to: "Sung Wong Toi å®‹çš‡è‡º", line: "tw" },
          { from: "Sung Wong Toi å®‹çš‡è‡º", to: "Kai Tak å•Ÿå¾·", line: "tw" },
          { from: "Kai Tak å•Ÿå¾·", to: "Diamond Hill é‘½çŸ³å±±", line: "tw" },
          { from: "Diamond Hill é‘½çŸ³å±±", to: "Hin Keng é¡¯å¾‘", line: "tw" },
          { from: "Hin Keng é¡¯å¾‘", to: "Tai Wai å¤§åœ", line: "tw" },
          { from: "Tai Wai å¤§åœ", to: "Che Kung Temple è»Šå…¬å»Ÿ", line: "tw" },
          {
            from: "Che Kung Temple è»Šå…¬å»Ÿ",
            to: "Sha Tin Wai æ²™ç”°åœ",
            line: "tw",
          },
          { from: "Sha Tin Wai æ²™ç”°åœ", to: "City One ç¬¬ä¸€åŸ", line: "tw" },
          { from: "City One ç¬¬ä¸€åŸ", to: "Shek Mun çŸ³é–€", line: "tw" },
          { from: "Shek Mun çŸ³é–€", to: "Tai Shui Hang å¤§æ°´å‘", line: "tw" },
          { from: "Tai Shui Hang å¤§æ°´å‘", to: "Heng On æ’å®‰", line: "tw" },
          { from: "Heng On æ’å®‰", to: "Ma On Shan é¦¬éå±±", line: "tw" },
          { from: "Ma On Shan é¦¬éå±±", to: "Wu Kai Sha çƒæºªæ²™", line: "tw" },

          // æ±æ¶Œç·š
          { from: "Tung Chung æ±æ¶Œ", to: "Sunny Bay æ¬£æ¾³", line: "tcl" },
          { from: "Sunny Bay æ¬£æ¾³", to: "Tsing Yi é’è¡£", line: "tcl" },
          { from: "Tsing Yi é’è¡£", to: "Lai King è”æ™¯", line: "tcl" },
          { from: "Lai King è”æ™¯", to: "Nam Cheong å—æ˜Œ", line: "tcl" },
          { from: "Nam Cheong å—æ˜Œ", to: "Olympic å¥§é‹", line: "tcl" },
          { from: "Olympic å¥§é‹", to: "Kowloon ä¹é¾", line: "tcl" },
          { from: "Kowloon ä¹é¾", to: "Hong Kong é¦™æ¸¯", line: "tcl" },

          // èƒç£ç·š
          { from: "Tsuen Wan èƒç£", to: "Tai Wo Hau å¤§çª©å£", line: "twl" },
          { from: "Tai Wo Hau å¤§çª©å£", to: "Kwai Hing è‘µèˆˆ", line: "twl" },
          { from: "Kwai Hing è‘µèˆˆ", to: "Kwai Fong è‘µèŠ³", line: "twl" },
          { from: "Kwai Fong è‘µèŠ³", to: "Lai King è”æ™¯", line: "twl" },
          { from: "Lai King è”æ™¯", to: "Mei Foo ç¾å­š", line: "twl" },
          { from: "Mei Foo ç¾å­š", to: "Lai Chi Kok è”æè§’", line: "twl" },
          {
            from: "Lai Chi Kok è”æè§’",
            to: "Cheung Sha Wan é•·æ²™ç£",
            line: "twl",
          },
          {
            from: "Cheung Sha Wan é•·æ²™ç£",
            to: "Sham Shui Po æ·±æ°´åŸ—",
            line: "twl",
          },
          {
            from: "Sham Shui Po æ·±æ°´åŸ—",
            to: "Prince Edward å¤ªå­",
            line: "twl",
          },
          { from: "Prince Edward å¤ªå­", to: "Mong Kok æ—ºè§’", line: "twl" },
          { from: "Mong Kok æ—ºè§’", to: "Yau Ma Tei æ²¹éº»åœ°", line: "twl" },
          { from: "Yau Ma Tei æ²¹éº»åœ°", to: "Jordan ä½æ•¦", line: "twl" },
          { from: "Jordan ä½æ•¦", to: "Tsim Sha Tsui å°–æ²™å’€", line: "twl" },
          { from: "Tsim Sha Tsui å°–æ²™å’€", to: "Admiralty é‡‘é˜", line: "twl" },
          { from: "Admiralty é‡‘é˜", to: "Central ä¸­ç’°", line: "twl" },

          // æ¸¯å³¶ç·š
          { from: "Kennedy Town å …å°¼åœ°åŸ", to: "HKU é¦™æ¸¯å¤§å­¸", line: "il" },
          { from: "HKU é¦™æ¸¯å¤§å­¸", to: "Sai Ying Pun è¥¿ç‡Ÿç›¤", line: "il" },
          { from: "Sai Ying Pun è¥¿ç‡Ÿç›¤", to: "Sheung Wan ä¸Šç’°", line: "il" },
          { from: "Sheung Wan ä¸Šç’°", to: "Central ä¸­ç’°", line: "il" },
          { from: "Central ä¸­ç’°", to: "Admiralty é‡‘é˜", line: "il" },
          { from: "Admiralty é‡‘é˜", to: "Wan Chai ç£ä»”", line: "il" },
          { from: "Wan Chai ç£ä»”", to: "Causeway Bay éŠ…é‘¼ç£", line: "il" },
          { from: "Causeway Bay éŠ…é‘¼ç£", to: "Tin Hau å¤©å", line: "il" },
          { from: "Tin Hau å¤©å", to: "Fortress Hill ç‚®å°å±±", line: "il" },
          { from: "Fortress Hill ç‚®å°å±±", to: "North Point åŒ—è§’", line: "il" },
          { from: "North Point åŒ—è§’", to: "Quarry Bay é°‚é­šæ¶Œ", line: "il" },
          { from: "Quarry Bay é°‚é­šæ¶Œ", to: "Tai Koo å¤ªå¤", line: "il" },
          { from: "Tai Koo å¤ªå¤", to: "Sai Wan Ho è¥¿ç£æ²³", line: "il" },
          { from: "Sai Wan Ho è¥¿ç£æ²³", to: "Shau Kei Wan ç­²ç®•ç£", line: "il" },
          {
            from: "Shau Kei Wan ç­²ç®•ç£",
            to: "Heng Fa Chuen æèŠ±é‚¨",
            line: "il",
          },
          { from: "Heng Fa Chuen æèŠ±é‚¨", to: "Chai Wan æŸ´ç£", line: "il" },

          // æ±éµç·š
          { from: "Lok Ma Chau è½é¦¬æ´²", to: "Sheung Shui ä¸Šæ°´", line: "erl" },
          { from: "Sheung Shui ä¸Šæ°´", to: "Fanling ç²‰å¶º", line: "erl" },
          { from: "Fanling ç²‰å¶º", to: "Tai Wo å¤ªå’Œ", line: "erl" },
          { from: "Tai Wo å¤ªå’Œ", to: "Tai Po Market å¤§åŸ”å¢Ÿ", line: "erl" },
          { from: "Tai Po Market å¤§åŸ”å¢Ÿ", to: "University å¤§å­¸", line: "erl" },
          { from: "University å¤§å­¸", to: "Fo Tan ç«ç‚­", line: "erl" },
          { from: "Fo Tan ç«ç‚­", to: "Sha Tin æ²™ç”°", line: "erl" },
          { from: "Sha Tin æ²™ç”°", to: "Tai Wai å¤§åœ", line: "erl" },
          { from: "Tai Wai å¤§åœ", to: "Kowloon Tong ä¹é¾å¡˜", line: "erl" },
          {
            from: "Kowloon Tong ä¹é¾å¡˜",
            to: "Mong Kok East æ—ºè§’æ±",
            line: "erl",
          },
          { from: "Mong Kok East æ—ºè§’æ±", to: "Hung Hom ç´…ç£¡", line: "erl" },
          { from: "Hung Hom ç´…ç£¡", to: "Exhibition Centre æœƒå±•", line: "erl" },
          { from: "Exhibition Centre æœƒå±•", to: "Admiralty é‡‘é˜", line: "erl" },

          // å°‡è»æ¾³ç·š
          { from: "LOHAS Park åº·åŸ", to: "Po Lam å¯¶ç³", line: "tkl" },
          { from: "Po Lam å¯¶ç³", to: "Hang Hau å‘å£", line: "tkl" },
          { from: "Hang Hau å‘å£", to: "Tseung Kwan O å°‡è»æ¾³", line: "tkl" },
          {
            from: "Tseung Kwan O å°‡è»æ¾³",
            to: "Tiu Keng Leng èª¿æ™¯å¶º",
            line: "tkl",
          },
          { from: "Tiu Keng Leng èª¿æ™¯å¶º", to: "Yau Tong æ²¹å¡˜", line: "tkl" },
          { from: "Yau Tong æ²¹å¡˜", to: "Quarry Bay é°‚é­šæ¶Œ", line: "tkl" },
          { from: "Quarry Bay é°‚é­šæ¶Œ", to: "North Point åŒ—è§’", line: "tkl" },

          // è§€å¡˜ç·š
          { from: "Whampoa é»ƒåŸ”", to: "Ho Man Tin ä½•æ–‡ç”°", line: "ktl" },
          { from: "Ho Man Tin ä½•æ–‡ç”°", to: "Yau Ma Tei æ²¹éº»åœ°", line: "ktl" },
          { from: "Yau Ma Tei æ²¹éº»åœ°", to: "Mong Kok æ—ºè§’", line: "ktl" },
          { from: "Mong Kok æ—ºè§’", to: "Prince Edward å¤ªå­", line: "ktl" },
          {
            from: "Prince Edward å¤ªå­",
            to: "Shek Kip Mei çŸ³ç¡¤å°¾",
            line: "ktl",
          },
          {
            from: "Shek Kip Mei çŸ³ç¡¤å°¾",
            to: "Kowloon Tong ä¹é¾å¡˜",
            line: "ktl",
          },
          { from: "Kowloon Tong ä¹é¾å¡˜", to: "Lok Fu æ¨‚å¯Œ", line: "ktl" },
          { from: "Lok Fu æ¨‚å¯Œ", to: "Wong Tai Sin é»ƒå¤§ä»™", line: "ktl" },
          {
            from: "Wong Tai Sin é»ƒå¤§ä»™",
            to: "Diamond Hill é‘½çŸ³å±±",
            line: "ktl",
          },
          { from: "Diamond Hill é‘½çŸ³å±±", to: "Choi Hung å½©è™¹", line: "ktl" },
          { from: "Choi Hung å½©è™¹", to: "Kowloon Bay ä¹é¾ç£", line: "ktl" },
          {
            from: "Kowloon Bay ä¹é¾ç£",
            to: "Ngau Tau Kok ç‰›é ­è§’",
            line: "ktl",
          },
          { from: "Ngau Tau Kok ç‰›é ­è§’", to: "Kwun Tong è§€å¡˜", line: "ktl" },
          { from: "Kwun Tong è§€å¡˜", to: "Lam Tin è—ç”°", line: "ktl" },
          { from: "Lam Tin è—ç”°", to: "Yau Tong æ²¹å¡˜", line: "ktl" },
        ],

        // ç²å–ç›¸é„°è»Šç«™
        getConnectedStations(stationName) {
          const connected = [];
          this.connections.forEach((conn) => {
            if (conn.from === stationName) {
              connected.push(conn.to);
            } else if (conn.to === stationName) {
              connected.push(conn.from);
            }
          });
          return connected;
        },

        // ç²å–è»Šç«™ä¿¡æ¯
        getStation(stationName) {
          return this.stations[stationName];
        },

        // ç²å–éš¨æ©Ÿèµ·å§‹ç«™
        getRandomStart() {
          const startingStations = [
            "Tsuen Wan èƒç£",
            "Tuen Mun å±¯é–€",
            "Tung Chung æ±æ¶Œ",
            "Lok Ma Chau è½é¦¬æ´²",
            "Kennedy Town å …å°¼åœ°åŸ",
          ];
          const randomIndex = Math.floor(
            Math.random() * startingStations.length
          );
          return startingStations[randomIndex];
        },
      };

      // éŠæˆ²ä¸»é¡
      class FinanceGame {
        constructor(studentId, nickname) {
          this.studentId = studentId;
          this.nickname = nickname;

          // éŠæˆ²æ™‚é–“è¨­ç½®
          this.startDate = new Date(2025, 9, 12); // 2025å¹´10æœˆ12æ—¥
          this.currentDate = new Date(2025, 9, 12);
          this.currentDay = 1;
          this.totalDays = 365;

          this.previousStation = null;
          this.visitedStations = new Set();
          this.stationHistory = []; // è¨˜éŒ„ç§»å‹•æ­·å²

          // ç©å®¶ç‹€æ…‹
          this.player = {
            name: nickname,
            assets: 1000,
            currentStation: gameBoard.getRandomStart(),
            line: this.getLineFromStation(gameBoard.getRandomStart()),
            dailySavings: 1,
            weeklyAllowance: 300,
            totalSavings: 0,
            weeklyAllowanceReceived: false,
          };

          // è¨˜éŒ„èµ·å§‹ç«™
          this.visitedStations.add(this.player.currentStation);
          this.stationHistory.push(this.player.currentStation);

          // ç‰©åƒ¹æŒ‡æ•¸
          this.priceIndex = {
            tw: 1.015, // å±¯é¦¬ç·š 1.5%
            twl: 1.03, // èƒç£ç·š 3%
            tcl: 1.05, // æ±æ¶Œç·š 5%
            erl: 1.07, // æ±éµç·š 7%
            ktl: 1.09, // è§€å¡˜ç·š 9%
            tkl: 1.09, // å°‡è»æ¾³ç·š 9%
            il: 1.1, // æ¸¯å³¶ç·š 10%
          };

          // å£äº‹ä»¶åº«
          this.badEvents = [
            {
              title: "ğŸš¨ Phone Scam é›»è©±è©é¨™",
              message:
                "You received a scam call and lost $200!\nä½ æ¥åˆ°è©é¨™é›»è©±ï¼Œæå¤±äº†$200ï¼",
              effect: { cash: -200 },
            },
            {
              title: "ğŸŒ€ Typhoon Delay å…«è™Ÿé¢¨çƒ",
              message:
                "Typhoon signal No.8! Train delayed.\nå…«è™Ÿé¢¨çƒï¼åˆ—è»Šå»¶èª¤ã€‚",
              effect: { moveBack: true },
            },
            {
              title: "ğŸš· Jaywalking Fine äº‚éé¦¬è·¯",
              message:
                "You jaywalked and got a $150 fine!\nä½ äº‚éé¦¬è·¯ï¼Œè¢«ç½°æ¬¾$150ï¼",
              effect: { cash: -150 },
            },
            {
              title: "ğŸ“‰ Investment Loss æŠ•è³‡æå¤±",
              message:
                "Stock market crashed! Lost $300.\nè‚¡å¸‚å¤§è·Œï¼æŠ•è³‡æå¤±$300ã€‚",
              effect: { cash: -300 },
            },
            {
              title: "ğŸ›ï¸ Impulse Shopping è¡å‹•æ¶ˆè²»",
              message:
                "You spent $180 on unnecessary shopping!\nä½ è¡å‹•æ¶ˆè²»äº†$180ï¼",
              effect: { cash: -180 },
            },
          ];

          // ç†è²¡å•ç­”é¡Œåº«
          this.financeQuestions = [
            {
              question: "æ‡‰è©²å„²è“„è‡³å°‘20%çš„æ”¶å…¥å—ï¼Ÿ",
              correct: true,
              explanation: "æ˜¯çš„ï¼é¤Šæˆå„²è“„ç¿’æ…£å¯ä»¥å»ºç«‹ç©©å›ºçš„è²¡å‹™åŸºç¤ã€‚",
            },
            {
              question: "æŠŠæ‰€æœ‰éŒ¢æŠ•è³‡åœ¨ä¸€éš»è‚¡ç¥¨æ˜¯æ˜æ™ºçš„å—ï¼Ÿ",
              correct: false,
              explanation: "ä¸å°ï¼æ‡‰è©²åˆ†æ•£æŠ•è³‡ä»¥é™ä½é¢¨éšªã€‚",
            },
            {
              question: "æ‡‰è©²åœ¨å¤§å­¸å°±é–‹å§‹è·æ¶¯è¦åŠƒå—ï¼Ÿ",
              correct: true,
              explanation: "æ˜¯çš„ï¼åŠæ—©è¦åŠƒæœ‰åŠ©æ–¼æœªä¾†ç™¼å±•ã€‚",
            },
            {
              question: "å€ŸéŒ¢è²·å¥¢ä¾ˆå“æ˜¯å¥½çš„è²¡å‹™æ±ºå®šå—ï¼Ÿ",
              correct: false,
              explanation: "ä¸å°ï¼æ‡‰é¿å…ç‚ºéå¿…éœ€å“è² å‚µã€‚",
            },
            {
              question: "æ‡‰è©²æœ‰3-6å€‹æœˆé–‹æ”¯çš„æ‡‰æ€¥åŸºé‡‘å—ï¼Ÿ",
              correct: true,
              explanation: "æ˜¯çš„ï¼æ‡‰æ€¥åŸºé‡‘å¯ä»¥æ‡‰ä»˜çªç™¼æƒ…æ³ã€‚",
            },
            {
              question: "æŠ•è³‡æ™‚æ‡‰è©²è¿½é«˜æ®ºä½å—ï¼Ÿ",
              correct: false,
              explanation: "ä¸å°ï¼æ‡‰è©²éµå¾ªåƒ¹å€¼æŠ•è³‡åŸå‰‡ã€‚",
            },
            {
              question: "å®šæœŸå®šé¡æŠ•è³‡æ˜¯å¥½çš„ç†è²¡æ–¹å¼å—ï¼Ÿ",
              correct: true,
              explanation: "æ˜¯çš„ï¼å¯ä»¥å¹³å‡æˆæœ¬ï¼Œé™ä½å¸‚å ´æ³¢å‹•é¢¨éšªã€‚",
            },
            {
              question: "ä¿¡ç”¨å¡åˆ·çˆ†æ›ç¾é‡‘æ˜¯å¥½ä¸»æ„å—ï¼Ÿ",
              correct: false,
              explanation: "ä¸å°ï¼é€™æœƒå°è‡´é«˜é¡åˆ©æ¯æ”¯å‡ºã€‚",
            },
            {
              question: "æŠ•è³‡çµ„åˆæ‡‰è©²å®šæœŸæª¢è¦–ä¸¦èª¿æ•´å—ï¼Ÿ",
              correct: true,
              explanation: "æ˜¯çš„ï¼å®šæœŸæª¢è¦–å¯ä»¥ç¢ºä¿æŠ•è³‡ç­–ç•¥ç¬¦åˆç›®æ¨™ã€‚",
            },
            {
              question: "æ”¶å…¥å¢åŠ æ™‚ï¼Œæ‡‰è©²ç›¸æ‡‰æé«˜å„²è“„æ¯”ä¾‹å—ï¼Ÿ",
              correct: true,
              explanation: "æ˜¯çš„ï¼é¿å…ç”Ÿæ´»è†¨è„¹ï¼Œå„ªå…ˆæé«˜å„²è“„ã€‚",
            },
          ];

          this.initializeGame();
        }

        getLineFromStation(stationName) {
          const station = gameBoard.stations[stationName];
          return station ? station.line.split(",")[0] : "twl";
        }

        initializeGame() {
          this.updateDisplay();
          this.drawGameBoard();
          this.showPlayerAtStation(this.player.currentStation);
        }

        nextDay() {
          if (this.currentDay > this.totalDays) {
            this.showGameOver();
            return;
          }

          // æ›´æ–°æ—¥æœŸå’Œå¤©æ•¸
          this.currentDate.setDate(this.currentDate.getDate() + 1);
          this.currentDay++;

          // è¨˜éŒ„ä¸Šä¸€å€‹è»Šç«™
          this.previousStation = this.player.currentStation;

          // === è²¡å‹™è¨ˆç®— ===
          let dailyReport = [];

          // 1. å¼·åˆ¶å„²è“„ (ç¬¬1å¤©$1, ç¬¬2å¤©$2, ç¬¬3å¤©$3...)
          const todaySavings = this.currentDay;
          this.player.assets += todaySavings;
          this.player.totalSavings += todaySavings;
          dailyReport.push(`ğŸ’° å¼·åˆ¶å„²è“„: +$${todaySavings}`);

          // 2. æ¯é€±é›¶ç”¨éŒ¢ (æ¯é€±æ—¥ç™¼æ”¾$300)
          const isSunday = this.currentDate.getDay() === 0;
          if (isSunday) {
            this.player.assets += this.player.weeklyAllowance;
            dailyReport.push(`ğŸ‰ é€±æœ«é›¶ç”¨éŒ¢: +$${this.player.weeklyAllowance}`);
          }

          // é‡ç½®æ¯é€±é›¶ç”¨éŒ¢æ¨™è¨˜ (æ¯é€±ä¸€é‡ç½®)
          if (this.currentDate.getDay() === 1) {
            this.player.weeklyAllowanceReceived = false;
          }

          // 3. æ—¥å¸¸é–‹æ”¯
          const isWeekend =
            this.currentDate.getDay() === 0 || this.currentDate.getDay() === 6;
          const transportCost = isWeekend ? 10 : 20; // é€±æœ«$10, å¹³æ—¥$20
          const mealCost = 30; // è†³é£Ÿè²»$30
          const dailyExpense = transportCost + mealCost;
          this.player.assets -= dailyExpense;
          dailyReport.push(`ğŸš‡ äº¤é€šè²»: -$${transportCost}`);
          dailyReport.push(`ğŸœ è†³é£Ÿè²»: -$${mealCost}`);

          // 4. æ‡‰ç”¨ç‰©åƒ¹æŒ‡æ•¸
          const currentPriceIndex = this.priceIndex[this.player.line] || 1;
          const inflationEffect = Math.floor(
            this.player.assets * (currentPriceIndex - 1)
          );
          if (inflationEffect !== 0) {
            this.player.assets = Math.floor(
              this.player.assets * currentPriceIndex
            );
            dailyReport.push(`ğŸ“ˆ ç‰©åƒ¹å½±éŸ¿: -$${inflationEffect}`);
          }

          // é¡¯ç¤ºæ—¥å ±
          this.showMessage(
            `==== ç¬¬ ${this.currentDay} å¤©è²¡å‹™å ±å‘Š ====\n${dailyReport.join(
              "\n"
            )}\n==================\nç•¶å‰ç¸½è³‡ç”¢: $${this.player.assets}`
          );

          // ç§»å‹•åˆ°ä¸‹ä¸€ç«™
          this.moveToNextStation();

          // æ›´æ–°é¡¯ç¤º
          this.updateDisplay();

          // è§¸ç™¼äº‹ä»¶
          this.triggerStationEvent();

          // æª¢æŸ¥é€šé—œæ¢ä»¶
          if (this.player.assets >= 10000) {
            this.showVictory();
          }

          console.log(
            `Day ${this.currentDay}: ${this.formatDate(
              this.currentDate
            )} | Station: ${this.player.currentStation} | Assets: $${
              this.player.assets
            } | Savings: $${todaySavings} | Expense: $${dailyExpense}`
          );
        }

        formatDate(date) {
          const year = date.getFullYear();
          const month = (date.getMonth() + 1).toString().padStart(2, "0");
          const day = date.getDate().toString().padStart(2, "0");
          const weekdays = [
            "æ˜ŸæœŸæ—¥",
            "æ˜ŸæœŸä¸€",
            "æ˜ŸæœŸäºŒ",
            "æ˜ŸæœŸä¸‰",
            "æ˜ŸæœŸå››",
            "æ˜ŸæœŸäº”",
            "æ˜ŸæœŸå…­",
          ];
          const weekday = weekdays[date.getDay()];
          return `${year}-${month}-${day} ${weekday}`;
        }

        moveToNextStation() {
          const connectedStations = gameBoard.getConnectedStations(
            this.player.currentStation
          );
          if (connectedStations.length > 0) {
            // å„ªå…ˆé¸æ“‡æœªè¨ªå•éçš„è»Šç«™
            const unvisitedStations = connectedStations.filter(
              (station) => !this.visitedStations.has(station)
            );

            let nextStation;
            if (unvisitedStations.length > 0) {
              // æœ‰æœªè¨ªå•çš„è»Šç«™ï¼Œéš¨æ©Ÿé¸æ“‡ä¸€å€‹
              nextStation =
                unvisitedStations[
                  Math.floor(Math.random() * unvisitedStations.length)
                ];
            } else {
              // æ‰€æœ‰ç›¸é„°è»Šç«™éƒ½è¨ªå•éï¼Œéš¨æ©Ÿé¸æ“‡ä¸€å€‹
              nextStation =
                connectedStations[
                  Math.floor(Math.random() * connectedStations.length)
                ];
            }

            // è¨˜éŒ„è¨ªå•
            this.visitedStations.add(nextStation);
            this.stationHistory.push(nextStation);

            // å¦‚æœæ˜¯æ›ä¹˜ç«™ï¼Œè®“ç©å®¶é¸æ“‡è·¯ç·š
            if (gameBoard.interchangeStations.includes(nextStation)) {
              this.showLineSelection(nextStation);
            } else {
              this.player.currentStation = nextStation;
              this.player.line = this.getLineFromStation(nextStation);
              this.showPlayerAtStation(nextStation);
            }
          }
        }

        moveBackStation() {
          if (this.stationHistory.length > 1) {
            // ç§»é™¤ç•¶å‰è»Šç«™
            this.stationHistory.pop();
            // å›åˆ°ä¸Šä¸€å€‹è»Šç«™
            const previousStation =
              this.stationHistory[this.stationHistory.length - 1];
            this.player.currentStation = previousStation;
            this.player.line = this.getLineFromStation(previousStation);
            this.showPlayerAtStation(previousStation);
            this.updateDisplay();
          }
        }

        showLineSelection(station) {
          const stationInfo = gameBoard.getStation(station);
          const availableLines = stationInfo.line.split(",");

          if (availableLines.length > 1) {
            const modal = document.getElementById("eventModal");
            const eventTitle = document.getElementById("eventTitle");
            const eventMessage = document.getElementById("eventMessage");
            const eventChoices = document.getElementById("eventChoices");

            eventTitle.textContent = "ğŸ”„ è½‰è»Šç«™é¸æ“‡";
            eventMessage.textContent = `ä½ å·²åˆ°é”${station}ï¼Œè«‹é¸æ“‡è¦è½‰ä¹˜çš„è·¯ç·šï¼š`;
            eventChoices.innerHTML = "";

            availableLines.forEach((line) => {
              const button = document.createElement("button");
              button.className = "choice-btn primary";
              button.textContent = this.getLineName(line);
              button.onclick = () => {
                this.player.currentStation = station;
                this.player.line = line;
                this.showPlayerAtStation(station);
                this.updateDisplay();
                modal.classList.remove("active");
              };
              eventChoices.appendChild(button);
            });

            modal.classList.add("active");
          } else {
            this.player.currentStation = station;
            this.player.line = availableLines[0];
            this.showPlayerAtStation(station);
          }
        }

        getLineName(lineCode) {
          const lineNames = {
            twl: "Tsuen Wan Line èƒç£ç·š",
            tw: "Tuen Ma Line å±¯é¦¬ç·š",
            tcl: "Tung Chung Line æ±æ¶Œç·š",
            erl: "East Rail Line æ±éµç·š",
            ktl: "Kwun Tong Line è§€å¡˜ç·š",
            tkl: "Tseung Kwan O Line å°‡è»æ¾³ç·š",
            il: "Island Line æ¸¯å³¶ç·š",
          };
          return lineNames[lineCode] || lineCode;
        }

        triggerStationEvent() {
          const station = this.player.currentStation;

          // ç‰¹æ®Šç«™é»äº‹ä»¶
          const specialEvents = {
            "Kwai Fong è‘µèŠ³": {
              title: "ğŸ¯ Weekend Plans é€±æœ«è¨ˆåŠƒ",
              message:
                "Friends invite you out. Go to Kwai Chung Plaza or play board games at home?\næœ‹å‹ç´„ä½ å‡ºå»ç©ã€‚å»è‘µæ¶Œå»£å ´é‚„æ˜¯åœ¨å®¶ç©æ¡ŒéŠï¼Ÿ",
              choices: [
                {
                  text: "Kwai Chung Plaza è‘µæ¶Œå»£å ´",
                  cost: 100,
                },
                {
                  text: "Board Games at Home åœ¨å®¶ç©æ¡ŒéŠ",
                  cost: 50,
                },
              ],
            },
          };

          // å¹¸é‹ç«™é»
          const luckyStations = [
            "Wu Kai Sha çƒæºªæ²™",
            "Admiralty é‡‘é˜",
            "LOHAS Park åº·åŸ",
            "Chai Wan æŸ´ç£",
            "Hong Kong é¦™æ¸¯",
          ];
          if (luckyStations.includes(station)) {
            this.showEvent(
              "ğŸ€ Lucky Event å¹¸é‹äº‹ä»¶",
              "You found $150 on the ground!\nä½ åœ¨åœ°ä¸Šæ’¿åˆ°$150ï¼",
              [],
              { cash: 150 }
            );
            return;
          }

          // æ—¥å¸¸éš¨æ©Ÿäº‹ä»¶
          const random = Math.random();
          if (random < 0.3) {
            // 30% æ©Ÿç‡è§¸ç™¼æ—¥å¸¸äº‹ä»¶
            if (random < 0.1) {
              // 10% æ©Ÿç‡è§¸ç™¼å£äº‹ä»¶
              const badEvent =
                this.badEvents[
                  Math.floor(Math.random() * this.badEvents.length)
                ];
              this.showEvent(
                badEvent.title,
                badEvent.message,
                [],
                badEvent.effect
              );
            } else if (random < 0.2) {
              // 10% æ©Ÿç‡è§¸ç™¼ç†è²¡å•ç­”
              this.showFinanceQuiz();
            } else {
              // 10% æ©Ÿç‡è§¸ç™¼å¥½äº‹ä»¶
              this.showEvent(
                "ğŸ“š Tutoring è£œç¿’è³ºéŒ¢",
                "You tutored classmates and earned $200!\nä½ å¹«åŒå­¸è£œç¿’è³ºäº†$200ï¼",
                [],
                { cash: 200 }
              );
            }
          } else if (specialEvents[station]) {
            // ç‰¹æ®Šç«™é»äº‹ä»¶
            const event = specialEvents[station];
            this.showEvent(
              event.title,
              event.message,
              event.choices.map((choice) => ({
                text: choice.text,
                action: () => {
                  if (choice.cost) {
                    const cost = Math.floor(
                      choice.cost * (this.priceIndex[this.player.line] || 1)
                    );
                    this.player.assets -= cost;
                    this.showMessage(`Cost: $${cost}\nèŠ±è²»ï¼š$${cost}`);
                  }
                  this.updateDisplay();
                },
              }))
            );
          }
        }

        showFinanceQuiz() {
          const question =
            this.financeQuestions[
              Math.floor(Math.random() * this.financeQuestions.length)
            ];
          this.showEvent("ğŸ’¡ Financial Quiz ç†è²¡å•ç­”", question.question, [
            {
              text: "Yes æ˜¯",
              action: () => {
                if (question.correct) {
                  this.showMessage(
                    `Correct! ${question.explanation}\nYou move forward!\nç­”å°äº†ï¼${question.explanation}\nä½ å‰é€²ä¸€æ­¥ï¼`
                  );
                  // ç­”å°å‰é€²ä¸€æ­¥
                  this.moveToNextStation();
                } else {
                  this.showMessage(
                    `Wrong! ${question.explanation}\nYou move back!\nç­”éŒ¯äº†ï¼${question.explanation}\nä½ å¾Œé€€ä¸€æ­¥ï¼`
                  );
                  // ç­”éŒ¯å¾Œé€€ä¸€æ­¥
                  this.moveBackStation();
                }
                this.updateDisplay();
              },
            },
            {
              text: "No å¦",
              action: () => {
                if (!question.correct) {
                  this.showMessage(
                    `Correct! ${question.explanation}\nYou move forward!\nç­”å°äº†ï¼${question.explanation}\nä½ å‰é€²ä¸€æ­¥ï¼`
                  );
                  // ç­”å°å‰é€²ä¸€æ­¥
                  this.moveToNextStation();
                } else {
                  this.showMessage(
                    `Wrong! ${question.explanation}\nYou move back!\nç­”éŒ¯äº†ï¼${question.explanation}\nä½ å¾Œé€€ä¸€æ­¥ï¼`
                  );
                  // ç­”éŒ¯å¾Œé€€ä¸€æ­¥
                  this.moveBackStation();
                }
                this.updateDisplay();
              },
            },
          ]);
        }

        showEvent(title, message, choices = [], effect = null) {
          const modal = document.getElementById("eventModal");
          const emoji = document.getElementById("eventEmoji");
          const titleEl = document.getElementById("eventTitle");
          const messageEl = document.getElementById("eventMessage");
          const choicesEl = document.getElementById("eventChoices");

          // è¨­ç½®äº‹ä»¶å…§å®¹
          emoji.textContent = title.includes("Lucky")
            ? "ğŸ€"
            : title.includes("Quiz")
            ? "ğŸ’¡"
            : title.includes("Scam")
            ? "ğŸš¨"
            : "ğŸ¯";
          titleEl.textContent = title;
          messageEl.textContent = message;

          // æ¸…ç©ºé¸æ“‡æŒ‰éˆ•
          choicesEl.innerHTML = "";

          // æ·»åŠ é¸æ“‡æŒ‰éˆ•
          choices.forEach((choice) => {
            const button = document.createElement("button");
            button.className = "choice-btn primary";
            button.textContent = choice.text;
            button.onclick = () => {
              choice.action();
              modal.classList.remove("active");
            };
            choicesEl.appendChild(button);
          });

          // å¦‚æœæ²’æœ‰é¸æ“‡ï¼Œæ·»åŠ ç¢ºå®šæŒ‰éˆ•
          if (choices.length === 0) {
            const confirmBtn = document.createElement("button");
            confirmBtn.className = "choice-btn primary";
            confirmBtn.textContent = "OK ç¢ºå®š";
            confirmBtn.onclick = () => {
              if (effect) {
                this.applyEffect(effect);
              }
              modal.classList.remove("active");
            };
            choicesEl.appendChild(confirmBtn);
          }

          // é¡¯ç¤ºå½ˆçª—
          modal.classList.add("active");
        }

        applyEffect(effect) {
          if (effect.cash) {
            this.player.assets += effect.cash;
            this.showMessage(
              `${effect.cash > 0 ? "Gained" : "Lost"} $${Math.abs(
                effect.cash
              )}!\n${effect.cash > 0 ? "ç²å¾—" : "æå¤±"}$${Math.abs(
                effect.cash
              )}ï¼`
            );
          }
          if (effect.moveBack) {
            this.moveBackStation();
            this.showMessage(
              "You moved back one station due to typhoon delay!\nå› é¢±é¢¨å»¶èª¤ï¼Œä½ å¾Œé€€äº†ä¸€æ­¥ï¼"
            );
          }
          this.updateDisplay();
        }

        showMessage(message) {
          alert(message);
        }

        updateDisplay() {
          // æ›´æ–°é ­éƒ¨ä¿¡æ¯
          document.getElementById("displayNickname").textContent =
            this.player.name;
          document.getElementById("displayStudentId").textContent =
            this.studentId;
          document.getElementById("currentDay").textContent = this.currentDay;
          document.getElementById("currentDate").textContent = this.formatDate(
            this.currentDate
          );
          document.getElementById("currentStation").textContent = `${
            this.player.currentStation
          } (${this.getLineName(this.player.line)})`;
          document.getElementById("totalAssets").textContent =
            this.player.assets.toLocaleString();
          document.getElementById("dailySavings").textContent = this.currentDay;

          // æ›´æ–°ç©å®¶è³‡è¨Šé¢æ¿
          document.getElementById("infoTotalAssets").textContent = `$${this.player.assets.toLocaleString()}`;
          document.getElementById("infoCurrentDay").textContent = `ç¬¬ ${this.currentDay} å¤©`;
          document.getElementById("infoCurrentStation").textContent = this.player.currentStation;
          document.getElementById("infoPriceIndex").textContent = (this.priceIndex[this.player.line] || 1).toFixed(3);
          document.getElementById("infoDailySavings").textContent = `$${this.currentDay}`;
          document.getElementById("infoTotalSavings").textContent = `$${this.player.totalSavings.toLocaleString()}`;
        }

        drawGameBoard() {
          const mapContainer = document.getElementById("railway-map");
          mapContainer.innerHTML = "";

          // ç¹ªè£½ç·šè·¯ - ä½¿ç”¨é€£æ¥é—œä¿‚ç¹ªè£½
          const linesDiv = document.createElement("div");
          linesDiv.className = "rail-lines";

          gameBoard.connections.forEach((conn) => {
            const fromStation = gameBoard.getStation(conn.from);
            const toStation = gameBoard.getStation(conn.to);

            if (fromStation && toStation) {
              const line = document.createElement("div");
              line.className = "rail-line";
              line.style.left = `${fromStation.x}%`;
              line.style.top = `${fromStation.y}%`;

              const dx = toStation.x - fromStation.x;
              const dy = toStation.y - fromStation.y;
              const length = Math.sqrt(dx * dx + dy * dy);
              const angle = (Math.atan2(dy, dx) * 180) / Math.PI;

              line.style.width = `${length}%`;
              line.style.transform = `rotate(${angle}deg)`;
              line.style.backgroundColor =
                gameBoard.lineColors[conn.line] || "#666";

              linesDiv.appendChild(line);
            }
          });

          mapContainer.appendChild(linesDiv);

          // ç¹ªè£½è»Šç«™
          const stationsDiv = document.createElement("div");
          stationsDiv.className = "stations";
          Object.entries(gameBoard.stations).forEach(([name, info]) => {
            const station = document.createElement("div");
            station.className = `station-marker ${
              name === this.player.currentStation ? "current" : ""
            }`;
            station.style.left = `${info.x}%`;
            station.style.top = `${info.y}%`;
            station.innerHTML = `
                        <div class="station-dot"></div>
                        <div class="station-name">${name}</div>
                    `;
            stationsDiv.appendChild(station);
          });
          mapContainer.appendChild(stationsDiv);
        }

        showPlayerAtStation(stationName) {
          const playerIcon = document.getElementById("player-icon");
          const station = gameBoard.getStation(stationName);

          if (station && playerIcon) {
            playerIcon.style.left = `${station.x}%`;
            playerIcon.style.top = `${station.y}%`;
            playerIcon.style.display = "block";

            // æ›´æ–°è»Šç«™æ¨™è¨˜
            document.querySelectorAll(".station-marker").forEach((marker) => {
              marker.classList.remove("current");
            });
            document.querySelectorAll(".station-marker").forEach((marker) => {
              if (
                marker.querySelector(".station-name").textContent ===
                stationName
              ) {
                marker.classList.add("current");
              }
            });
          }
        }

        showVictory() {
          this.showEvent(
            "ğŸ‰ Congratulations! æ­å–œï¼",
            `You've reached $10,000 in assets! Game completed!\nä½ å·²é”åˆ°$10,000è³‡ç”¢ï¼éŠæˆ²é€šé—œï¼\n\nFinal Score æœ€çµ‚åˆ†æ•¸: $${this.player.assets}\nTotal Savings ç¸½å„²è“„: $${this.player.totalSavings}`,
            [
              {
                text: "Play Again å†ç©ä¸€æ¬¡",
                action: () => location.reload(),
              },
            ]
          );
        }

        showGameOver() {
          this.showEvent(
            "â° Game Over éŠæˆ²çµæŸ",
            `365 days have passed! Your final assets: $${this.player.assets}\n365å¤©éå»äº†ï¼ä½ çš„æœ€çµ‚è³‡ç”¢ï¼š$${this.player.assets}\nTotal Savings ç¸½å„²è“„: $${this.player.totalSavings}`,
            [
              {
                text: "Play Again å†ç©ä¸€æ¬¡",
                action: () => location.reload(),
              },
            ]
          );
        }
      }

      // éŠæˆ²åˆå§‹åŒ–
      let game;

      document.getElementById("startGameBtn").onclick = function () {
        const studentId = document.getElementById("studentId").value.trim();
        const nickname = document.getElementById("playerNickname").value.trim();

        if (!studentId || !nickname) {
          alert("Please fill in all information! è«‹å¡«å¯«æ‰€æœ‰ä¿¡æ¯ï¼");
          return;
        }

        // åˆ‡æ›åˆ°éŠæˆ²é é¢
        document.getElementById("login-page").classList.remove("active");
        document.getElementById("game-page").classList.add("active");

        // åˆå§‹åŒ–éŠæˆ²
        game = new FinanceGame(studentId, nickname);
      };

      document.getElementById("nextDayBtn").onclick = function () {
        if (game) {
          game.nextDay();
        }
      };

      document.getElementById("newGameBtn").onclick = function () {
        location.reload();
      };

      // é—œé–‰äº‹ä»¶å½ˆçª—çš„é»æ“Šäº‹ä»¶
      document.getElementById("eventModal").onclick = function (e) {
        if (e.target === this) {
          this.classList.remove("active");
        }
      };
    </script>
  </body>
</html>